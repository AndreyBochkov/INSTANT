<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Информация о работе INSTANT</title>
    <meta name="keywords" content="instant, messenger, chat, privacy, policy">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link rel="shortcut icon" href="/INSTANT_logo.png" type="image/x-icon">
</head>
<body>
    <div class="wrapper">
        <div class="logo">
            <a href="/index"><img src="/INSTANT.png" alt="Мессенджер INSTANT"></a>
        </div>
        <div class="text attention">
            <h2>
                ВНИМАНИЕ!
            </h2>
            <p>
                Приложение и инфраструктура INSTANT находятся в разработке. Сейчас ничего не работает - плановая дата запуска 31 августа 2025. Информация ниже недействительна (пока что).
            </p>
        </div>
        <div class="text">
            <h1>Информация о работе сервиса INSTANT.</h1>
        </div>
        <div class="text">
            <h2>1. Протокол шифрования.</h2>
            <p>INSTANT использует свой протокол шифрования, взявший лучшее от Signal Protocol и TLS 1.3. В первом пакете, "client-hello", клиент отправляет на сервер версию протокола, свой публичный долговременный ключ, подписанный сессионный ключ и его подпись (сгенерированную приватным долговременным ключом). Сервер, получив запрос на рукопожатие, проверяет подписи, генерирует 32 байта энтропии - serverRandom, и свою пару ключей, отправляя клиенту сообщение с типом '0', в качестве данных прилагая свой публичный ключ и serverRandom. Теперь и клиент, и сервер располагают данными для создания общего секрета, притом <span class="attention">фальсификация невозможна благодаря подписи</span>.</p>
            <p>Затем, в процессе обмена данными, сервер может инициировать ротацию ключей. Для этого он отправляет сообщение с типом '18' (отправляя новый serverRandom) и заменяет свой ключ, регенерируя его из старого с новым serverRandom. Таким образом, протокол INSTANT обеспечивает <span class="attention">рукопожатие за 2 пакета, а ротацию ключей за 1</span>.</p>
        </div>
        <div class="text">
            <h2>2. Обмен данными.</h2>
            <p>В процессе обмена данными клиент отправляет запрос определенного типа, а сервер отвечает либо ошибкой (тип > '100') или ответом. При фатальных ошибках '127' <span class="attention">соединение разрывается</span>. Вот примеры ошибок:</p>
            <ol>
                <li><p>124 Invalid Credentials</p></li>
                <li><p>126 Empty Credentials</p></li>
                <li><p>125 Duplicated Login (при регистрации)</p></li>
                <li><p>127 Invalid Version</p></li>
                <li><p>127 Invalid Handshake Pattern</p></li>
                <li><p>127 Internal Error</p></li>
                <li><p>127 Internal DB Error</p></li>
                <li><p>127 Unauthorized</p></li>
                <li><p>127 Internal JSON Error</p></li>
                <li><p>127 Internal AES Error</p></li>
                <li><p>127 Authorized</p></li>
            </ol>
            <p>Все ответы <span class="attention">шифруются общим секретом</span>, симметричным алгоритмом шифрования. <span class="attention">Ошибки передаются "в открытую"</span>, притом, если ошибка не фатальная, передается только код ошибки.</p>
        </div>
        <div class="text">
            <h2>3. Безопасность данных на сервере.</h2>
            <p>Пароли хранятся в базе данных как хэши, притом криптостойкие. То есть, <span class="attention">никто не может узнать пароль какого-либо аккаунта, располагая хоть всей базой данных</span>. Даже вы, если забудете пароль. Ограничений по смене пароля нет, рекомендуется делать это раз в несколько месяцев.</p>
            <p>Сообщения перемешиваются особым алгоритмом <span class="attention">(не шифрования!)</span> и отправляются на сервер. Сервер <span class="attention">не располагает</span> алгоритмом перемешивания, поэтому байты сообщений в базе данных <span class="attention">не хранятся в исходном виде</span>.</p>
        </div>
        <div class="text">
            <h2>4. Технические ограничения.</h2>
            <p>Смартфоны убивают фоновые подключения. Неоправданно безжалостно, но зато это гарантия дискретности веб-взаимодействий. Необходимо было вписаться в это требование, и пока приложение запускает дискретный фоновый процесс, который раз в три минуты <span class="attention">опрашивает сервер на предмет новых сообщений</span>. То есть, <span class="attention">задержка доставки при выключенном приложении - до трех минут</span>. Увы!</p>
        </div>
        <div class="text">
            <h2>5. Безопасность дискретных запросов.</h2>
            <p>Дискретные запросы по HTTP используют тот же протокол шифрования. Однако теперь "client-hello" встроен в запрос, а "server-hello" + зашифрованные данные - в ответ. Также необходимое условие - наличие токена регистрации в заголовках - <span class="attention">нельзя подделать запрос</span> и узнать чьи-либо сообщения, так как токены индивидуальны. Также у токенов есть срок действия - 48 часов. Если не заходить в приложение 2 дня, сообщения <span class="attention">перестанут приходить</span>, ни без задержки, ни с задержкой.</p>
        </div>
    </div>
    <footer>
        <div class="wrapper" style="text-align: end;">
            &copy; Бочков Андрей, 2025.
            <br>
            abochkov956@gmail.com
        </div>
    </footer>
</body>
</html>