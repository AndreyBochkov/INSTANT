<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Информация о работе INSTANT</title>
    <meta name="keywords" content="instant, messenger, chat, privacy, policy">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link rel="shortcut icon" href="/INSTANT_logo.png" type="image/x-icon">
</head>
<body>
    <div class="wrapper">
        <div class="logo">
            <a href="/index"><img src="/INSTANT.png" alt="Мессенджер INSTANT"></a>
        </div>
        <div class="text attention">
            <h2>
                ВНИМАНИЕ!
            </h2>
            <p>
                Приложение и инфраструктура INSTANT находятся в разработке. Сейчас ничего не работает - плановая дата запуска 31 августа 2025. Информация ниже недействительна (пока что).
            </p>
        </div>
        <div class="text">
            <h1>Информация о работе сервиса INSTANT.</h1>
        </div>
        <div class="text">
            <h2>1. Протокол обмена данными.</h2>
            <p>INSTANT использует свой протокол обмена данными и шифрования, взявший лучшее от Signal Protocol и TLS 1.3. Тип сообщения определяется первым его байтом, то есть существуют 256 возможных типов сообщений. Сейчас используется гораздо меньше.</p>
            <p>В целом, таблица типов выглядит так:</p>
            <div class="scroll">
                <table>
                    <tr>
                        <td>Диапазон</td>
                        <td>Название</td>
                        <td>Сейчас использовано</td>
                    </tr>
                    <tr>
                        <td>0..10</td>
                        <td>server_hello</td>
                        <td>0</td>
                    </tr>
                    <tr>
                        <td>11..50</td>
                        <td>Запросы</td>
                        <td>11..17</td>
                    </tr>
                    <tr>
                        <td>51..90</td>
                        <td>Ответы</td>
                        <td>51..57</td>
                    </tr>
                    <tr>
                        <td>90..100</td>
                        <td>Оповещения</td>
                        <td>91, 92</td>
                    </tr>
                    <tr>
                        <td>101..127</td>
                        <td>Ошибки</td>
                        <td>125..127</td>
                    </tr>
                    <tr>
                        <td>128..255</td>
                        <td class="attention" colspan="2">Не используется</td>
                    </tr>
                </table>
            </div>
            <p>Все возможные сообщения:</p>
            <div class="scroll">
                <table>
                    <tr>
                        <td>Тип сообщения</td>
                        <td>Название</td>
                        <td>Данные</td>
                        <td>Зашифровано?</td>
                    </tr>
                    <tr>
                        <td colspan="2">client_hello</td>
                        <td>[version][clientIK][clientSigned][clientSignature]</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>0</td>
                        <td>server_hello</td>
                        <td>[serverPublic][serverRandom]</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>GetChatsRequest</td>
                        <td colspan="2">&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td>SearchRequest</td>
                        <td>{"query":""}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>NewChatRequest</td>
                        <td>{"user2":0}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td>GetMessagesRequest</td>
                        <td>{"chatid":0;"offset":0}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>15</td>
                        <td>SendMessageRequest</td>
                        <td>{"receiver":0;"chatid":0;"body":""}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>16</td>
                        <td>ChangeIKeyRequest</td>
                        <td>{"new":[0,0...]}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>17</td>
                        <td>RegisterRequest</td>
                        <td>{"login":""}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>51</td>
                        <td>GetChatsResponse</td>
                        <td>[{"chatid":0,"user2":0,"label":""}...]</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>52</td>
                        <td>SearchResponse</td>
                        <td>[{"userid":0,"login":""}...]</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>53</td>
                        <td>NewChatResponse / NewChatAcknowledgement</td>
                        <td>{"chatid":0,"user2":0,"label":""}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>54</td>
                        <td>GetMessagesResponse</td>
                        <td>{"chatid":0,"messages":[{"messageid":0,"ts":0,"body":"",mine:false}...]}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>55</td>
                        <td>SendMessageResponse</td>
                        <td>{"messageid":0,"ts":0,"body":"","chatid":0}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>56</td>
                        <td>ChangeIKeyAcknowledgement</td>
                        <td colspan="2">&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>57</td>
                        <td>RegisterAcknowledgement</td>
                        <td colspan="2">&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>91</td>
                        <td>GotMessageAcknowledgement</td>
                        <td>{"messageid":0,"ts":0,"body":"","chatid":0}</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>92</td>
                        <td>RotateKey</td>
                        <td>[serverRandom]</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>125</td>
                        <td>DuplicatedLoginError</td>
                        <td colspan="2">&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>126</td>
                        <td>EmptyCredentialsError</td>
                        <td colspan="2">&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>127</td>
                        <td>FATAL</td>
                        <td>Invalid version</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>127</td>
                        <td>FATAL</td>
                        <td>Invalid handshake pattern</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>127</td>
                        <td>FATAL</td>
                        <td>Authorized</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>127</td>
                        <td>FATAL</td>
                        <td>Internal JSON error</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>127</td>
                        <td>FATAL</td>
                        <td>Unauthorized</td>
                        <td class="attention">Нет</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="text">
            <h2>2. Безопасный обмен данными.</h2>
            <p>При первом входе в приложение генерируется пара идентификационных ключей подписи. Теперь вся идентификация пользователя на сервере будет заключаться в сверке публичных идентификационных ключей (IKey, Identity Key).</p>
            <p>В первом пакете, "client_hello", клиент отправляет на сервер версию протокола, свой публичный IK, подписанный сессионный ключ и его подпись (сгенерированную приватным IK). Сервер, получив запрос на рукопожатие, проверяет подписи, генерирует 32 байта энтропии - serverRandom, и свою пару ключей, отправляя клиенту сообщение с типом '0', в качестве данных прилагая свой публичный ключ и serverRandom. Теперь и клиент, и сервер располагают данными для создания общего секрета, притом <span class="attention">фальсификация невозможна благодаря подписи</span>, и сервер уже знает, кто к нему обратился. Если нет, сервер ожидает запроса 17 (RegisterRequest).</p>
            <p>Затем, в процессе обмена данными, сервер может инициировать ротацию ключей. Для этого он отправляет сообщение с типом 92 (RotateKey) и заменяет свой ключ, регенерируя его из старого с новым serverRandom. Таким образом, протокол INSTANT обеспечивает <span class="attention">совершенную прямую секретность, рукопожатие за 2 пакета и ротацию ключей за 1</span>.</p>
        </div>
        <div class="text">
            <h2>3. Безопасность данных на сервере.</h2>
            <p>В INSTANT нет паролей, значит, нечего терять и отдавать. Вся идентификация построена на уникальных ключах. <span class="attention">Никто не может получить доступ к какому-либо аккаунту, располагая хоть всей базой данных</span>. Даже вы, если очистите данные приложения. По смене ключа ограничений нет, рекомендуется делать это раз в несколько недель.</p>
        </div>
        <div class="text">
            <h2>4. Технические ограничения.</h2>
            <p>Смартфоны убивают фоновые подключения. Неоправданно безжалостно, но зато это гарантия дискретности веб-взаимодействий. Необходимо вписаться в это требование, и пока <span class="attention">я не знаю, как</span>. Увы! Следите за обновлениями на этом сайте!</p>
        </div>
    </div>
    <footer>
        <div class="wrapper" style="text-align: end;">
            &copy; Бочков Андрей, 2025.
            <br>
            abochkov956@gmail.com | <a href="/privacy">Политика конфиденциальности и Условия использования</a> | <a href="/index">На главную</a>
        </div>
    </footer>
</body>
</html>