<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Информация о работе INSTANT</title>
    <meta name="keywords" content="instant, messenger, chat, privacy, policy">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/style.css">
    <link rel="shortcut icon" href="/INSTANT_logo.png" type="image/x-icon">
</head>
<body>
    <div class="logo">
        <img src="/INSTANT_logo.png" alt="">
        <div><h2>Мессенджер&nbsp;INSTANT</h2><p>Быстрота.&nbsp;Безопасность.&nbsp;Минимализм.</p></div>
    </div>
    <div class="button_wrap">
        <div class="button_row">
            <a class="button" href="/index">
                На главную
            </a>
            <a class="button" href="/privacy">
                Политика конф. и Условия использования
            </a>
            <a class="button" href="/INSTANT.apk">
                Скачать приложение
            </a>
            <a class="button" href="/changelog">
                Список изменений
            </a>
        </div>
    </div>
    <div class="wrapper">
        <div class="text">
            <h1>Информация о работе сервиса INSTANT. <a href="https://github.com/AndreyBochkov/INSTANT">Исходный код, если вы ищете его, выложен на GitHub</a>.</h1>
        </div>
        <div class="text">
            <h2>1. Протокол обмена данными.</h2>
            <p>INSTANT использует свой протокол обмена данными и шифрования, взявший лучшее от Signal Protocol и TLS 1.3. Тип сообщения определяется первым его байтом, то есть существуют 256 возможных типов сообщений. Сейчас используется гораздо меньше.</p>
            <p>В целом, таблица типов выглядит так:</p>
            <div class="scroll">
                <table>
                    <tr>
                        <td>Диапазон</td>
                        <td>Название</td>
                        <td>Сейчас использовано</td>
                    </tr>
                    <tr>
                        <td>0..10</td>
                        <td>server_hello</td>
                        <td>0, 1</td>
                    </tr>
                    <tr>
                        <td>11..50</td>
                        <td>Запросы</td>
                        <td>11..17, 49, 50</td>
                    </tr>
                    <tr>
                        <td>51..90</td>
                        <td>Ответы</td>
                        <td>51..57, 89, 90</td>
                    </tr>
                    <tr>
                        <td>90..100</td>
                        <td>Оповещения</td>
                        <td>100</td>
                    </tr>
                    <tr>
                        <td>101..127</td>
                        <td>Ошибки</td>
                        <td>124..127</td>
                    </tr>
                    <tr>
                        <td>128..255</td>
                        <td class="attention" colspan="2">Не используется</td>
                    </tr>
                </table>
            </div>
            <p>Все возможные сообщения:</p>
            <div class="scroll">
                <table>
                    <tr>
                        <td>Тип сообщения</td>
                        <td>Название</td>
                        <td>Зашифровано?</td>
                    </tr>
                    <tr>
                        <td colspan="2">client_hello</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>0, 1</td>
                        <td>server_hello</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>RegisterRequest</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td>GetChatsRequest</td>
                        <td>&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>SearchRequest</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td>GetPropertiesRequest</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>15</td>
                        <td>NewChatRequest</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>16</td>
                        <td>GetMessagesRequest</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>17</td>
                        <td>SendMessageRequest</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>49</td>
                        <td>GetAlertsRequest</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>50</td>
                        <td>ChangeIKeyRequest</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>51</td>
                        <td>RegisterAcknowledgement</td>
                        <td>&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>52</td>
                        <td>GetChatsResponse</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>53</td>
                        <td>SearchResponse</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>54</td>
                        <td>GetPropertiesResponse</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>55</td>
                        <td>NewChatResponse / NewChatAcknowledgement</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>56</td>
                        <td>GetMessagesResponse</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>57</td>
                        <td>SendMessageResponse</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>89</td>
                        <td>GetAlertsResponse</td>
                        <td>Да</td>
                    </tr>
                    <tr>
                        <td>90</td>
                        <td>ChangeIKeyAcknowledgement</td>
                        <td>&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>100</td>
                        <td>RotateKey</td>
                        <td class="attention">Нет</td>
                    </tr>
                    <tr>
                        <td>124</td>
                        <td>AccessDeniedError</td>
                        <td>&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>125</td>
                        <td>DuplicatedLoginError</td>
                        <td>&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>126</td>
                        <td>EmptyCredentialsError</td>
                        <td>&lt;пусто&gt;</td>
                    </tr>
                    <tr>
                        <td>127</td>
                        <td>FATAL</td>
                        <td class="attention">Нет</td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="text">
            <h2>2. Безопасный обмен данными.</h2>
            <p>При первом входе в приложение генерируется пара идентификационных ключей подписи. Теперь вся идентификация пользователя на сервере будет заключаться в сверке публичных идентификационных ключей (IKey, Identity Key).</p>
            <p>В первом пакете, "client_hello", клиент отправляет на сервер версию протокола, свой публичный IK, подписанный сессионный ключ и его подпись (сгенерированную приватным IK). Сервер, получив запрос на рукопожатие, проверяет подписи, генерирует 32 байта энтропии - serverRandom, и свою пару ключей, отправляя клиенту сообщение с типом '0', в качестве данных прилагая свой публичный ключ и serverRandom. Теперь и клиент, и сервер располагают данными для создания общего секрета, притом <span class="attention">фальсификация невозможна благодаря подписи</span>, и сервер уже знает, кто к нему обратился. Если нет, сервер ожидает запроса 11 (RegisterRequest).</p>
            <p>Затем, в процессе обмена данными, сервер может инициировать ротацию ключей. Для этого он отправляет сообщение с типом 100 (RotateKey) и заменяет свой ключ, регенерируя его из старого с новым serverRandom. Таким образом, протокол INSTANT обеспечивает <span class="attention">прямую секретность, рукопожатие с идентификацией за 2 пакета (161 б, 96 б) и ротацию ключей за 1 (32 б)</span>.</p>
        </div>
        <div class="text">
            <h2>3. Безопасность данных на сервере.</h2>
            <p>В INSTANT нет паролей, значит, нечего терять и отдавать. Вся идентификация построена на уникальных ключах. <span class="attention">Никто не может получить доступ к какому-либо аккаунту, располагая хоть всей базой данных публичных ключей</span>. Даже вы, если очистите данные приложения. По смене ключа ограничений нет, рекомендуется делать это раз в несколько недель.</p>
            <p>Не полагайтесь на безопасность данных на сервере. Все уязвимости нулевого дня будут как можно быстрее закрываться, всё ПО будет обновлено, однако <span class="attention">взлом всё равно возможен</span>.</p>
        </div>
        <div class="text">
            <h2>4. Технические ограничения.</h2>
            <p>Смартфоны убивают фоновые подключения. Неоправданно безжалостно, но зато это гарантия дискретности веб-взаимодействий. Необходимо вписаться в это требование, и пока <span class="attention">я не знаю, как</span>. Увы! <span class="attention">Синхронизации сообщений в фоне нет</span>, чтобы проверить наличие новых, надо открыть приложение. Но если какие-либо пользователи группы в сети, то устанавливается связь "в реальном времени". Следите за обновлениями на этом сайте.</p>
        </div>
    </div>
    <footer>
        <div class="wrapper" style="text-align: end;">
            &copy; Бочков Андрей, 2025. abochkov956@gmail.com <br>
            <a href="/privacy">Политика конфиденциальности и Условия использования</a> <br>
            <a href="/index">На главную</a> <br>
            <a href="/INSTANT.apk">Скачать APK-пакет приложения</a> <br>
        </div>
    </footer>
</body>
</html>